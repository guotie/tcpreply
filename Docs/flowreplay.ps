%!PS-Adobe-2.0
%%Creator: dvips(k) 5.95a Copyright 2005 Radical Eye Software
%%Title: flowreplay.dvi
%%Pages: 6
%%PageOrder: Ascend
%%BoundingBox: 0 0 595 842
%%DocumentFonts: Times-Roman Times-Bold CMSY10 Courier Times-Italic
%%DocumentPaperSizes: a4
%%EndComments
%DVIPSWebPage: (www.radicaleye.com)
%DVIPSCommandLine: dvips -o flowreplay.ps flowreplay.dvi
%DVIPSParameters: dpi=600
%DVIPSSource:  TeX output 2005.07.03:1303
%%BeginProcSet: tex.pro 0 0
%!
/TeXDict 300 dict def TeXDict begin/N{def}def/B{bind def}N/S{exch}N/X{S
N}B/A{dup}B/TR{translate}N/isls false N/vsize 11 72 mul N/hsize 8.5 72
mul N/landplus90{false}def/@rigin{isls{[0 landplus90{1 -1}{-1 1}ifelse 0
0 0]concat}if 72 Resolution div 72 VResolution div neg scale isls{
landplus90{VResolution 72 div vsize mul 0 exch}{Resolution -72 div hsize
mul 0}ifelse TR}if Resolution VResolution vsize -72 div 1 add mul TR[
matrix currentmatrix{A A round sub abs 0.00001 lt{round}if}forall round
exch round exch]setmatrix}N/@landscape{/isls true N}B/@manualfeed{
statusdict/manualfeed true put}B/@copies{/#copies X}B/FMat[1 0 0 -1 0 0]
N/FBB[0 0 0 0]N/nn 0 N/IEn 0 N/ctr 0 N/df-tail{/nn 8 dict N nn begin
/FontType 3 N/FontMatrix fntrx N/FontBBox FBB N string/base X array
/BitMaps X/BuildChar{CharBuilder}N/Encoding IEn N end A{/foo setfont}2
array copy cvx N load 0 nn put/ctr 0 N[}B/sf 0 N/df{/sf 1 N/fntrx FMat N
df-tail}B/dfs{div/sf X/fntrx[sf 0 0 sf neg 0 0]N df-tail}B/E{pop nn A
definefont setfont}B/Cw{Cd A length 5 sub get}B/Ch{Cd A length 4 sub get
}B/Cx{128 Cd A length 3 sub get sub}B/Cy{Cd A length 2 sub get 127 sub}
B/Cdx{Cd A length 1 sub get}B/Ci{Cd A type/stringtype ne{ctr get/ctr ctr
1 add N}if}B/CharBuilder{save 3 1 roll S A/base get 2 index get S
/BitMaps get S get/Cd X pop/ctr 0 N Cdx 0 Cx Cy Ch sub Cx Cw add Cy
setcachedevice Cw Ch true[1 0 0 -1 -.1 Cx sub Cy .1 sub]{Ci}imagemask
restore}B/D{/cc X A type/stringtype ne{]}if nn/base get cc ctr put nn
/BitMaps get S ctr S sf 1 ne{A A length 1 sub A 2 index S get sf div put
}if put/ctr ctr 1 add N}B/I{cc 1 add D}B/bop{userdict/bop-hook known{
bop-hook}if/SI save N @rigin 0 0 moveto/V matrix currentmatrix A 1 get A
mul exch 0 get A mul add .99 lt{/QV}{/RV}ifelse load def pop pop}N/eop{
SI restore userdict/eop-hook known{eop-hook}if showpage}N/@start{
userdict/start-hook known{start-hook}if pop/VResolution X/Resolution X
1000 div/DVImag X/IEn 256 array N 2 string 0 1 255{IEn S A 360 add 36 4
index cvrs cvn put}for pop 65781.76 div/vsize X 65781.76 div/hsize X}N
/p{show}N/RMat[1 0 0 -1 0 0]N/BDot 260 string N/Rx 0 N/Ry 0 N/V{}B/RV/v{
/Ry X/Rx X V}B statusdict begin/product where{pop false[(Display)(NeXT)
(LaserWriter 16/600)]{A length product length le{A length product exch 0
exch getinterval eq{pop true exit}if}{pop}ifelse}forall}{false}ifelse
end{{gsave TR -.1 .1 TR 1 1 scale Rx Ry false RMat{BDot}imagemask
grestore}}{{gsave TR -.1 .1 TR Rx Ry scale 1 1 false RMat{BDot}
imagemask grestore}}ifelse B/QV{gsave newpath transform round exch round
exch itransform moveto Rx 0 rlineto 0 Ry neg rlineto Rx neg 0 rlineto
fill grestore}B/a{moveto}B/delta 0 N/tail{A/delta X 0 rmoveto}B/M{S p
delta add tail}B/b{S p tail}B/c{-4 M}B/d{-3 M}B/e{-2 M}B/f{-1 M}B/g{0 M}
B/h{1 M}B/i{2 M}B/j{3 M}B/k{4 M}B/w{0 rmoveto}B/l{p -4 w}B/m{p -3 w}B/n{
p -2 w}B/o{p -1 w}B/q{p 1 w}B/r{p 2 w}B/s{p 3 w}B/t{p 4 w}B/x{0 S
rmoveto}B/y{3 2 roll p a}B/bos{/SS save N}B/eos{SS restore}B end

%%EndProcSet
%%BeginProcSet: 8r.enc 0 0
% File 8r.enc  TeX Base 1 Encoding  Revision 2.0  2002-10-30
%
% @@psencodingfile@{
%   author    = "S. Rahtz, P. MacKay, Alan Jeffrey, B. Horn, K. Berry,
%                W. Schmidt, P. Lehman",
%   version   = "2.0",
%   date      = "30 October 2002",
%   filename  = "8r.enc",
%   email     = "tex-fonts@@tug.org",
%   docstring = "This is the encoding vector for Type1 and TrueType
%                fonts to be used with TeX.  This file is part of the
%                PSNFSS bundle, version 9"
% @}
% 
% The idea is to have all the characters normally included in Type 1 fonts
% available for typesetting. This is effectively the characters in Adobe
% Standard encoding, ISO Latin 1, Windows ANSI including the euro symbol,
% MacRoman, and some extra characters from Lucida.
% 
% Character code assignments were made as follows:
% 
% (1) the Windows ANSI characters are almost all in their Windows ANSI
% positions, because some Windows users cannot easily reencode the
% fonts, and it makes no difference on other systems. The only Windows
% ANSI characters not available are those that make no sense for
% typesetting -- rubout (127 decimal), nobreakspace (160), softhyphen
% (173). quotesingle and grave are moved just because it's such an
% irritation not having them in TeX positions.
% 
% (2) Remaining characters are assigned arbitrarily to the lower part
% of the range, avoiding 0, 10 and 13 in case we meet dumb software.
% 
% (3) Y&Y Lucida Bright includes some extra text characters; in the
% hopes that other PostScript fonts, perhaps created for public
% consumption, will include them, they are included starting at 0x12.
% These are /dotlessj /ff /ffi /ffl.
% 
% (4) hyphen appears twice for compatibility with both ASCII and Windows.
%
% (5) /Euro was assigned to 128, as in Windows ANSI
%
% (6) Missing characters from MacRoman encoding incorporated as follows:
%
%     PostScript      MacRoman        TeXBase1
%     --------------  --------------  --------------
%     /notequal       173             0x16
%     /infinity       176             0x17
%     /lessequal      178             0x18
%     /greaterequal   179             0x19
%     /partialdiff    182             0x1A
%     /summation      183             0x1B
%     /product        184             0x1C
%     /pi             185             0x1D
%     /integral       186             0x81
%     /Omega          189             0x8D
%     /radical        195             0x8E
%     /approxequal    197             0x8F
%     /Delta          198             0x9D
%     /lozenge        215             0x9E
%
/TeXBase1Encoding [
% 0x00
 /.notdef /dotaccent /fi /fl
 /fraction /hungarumlaut /Lslash /lslash
 /ogonek /ring /.notdef /breve
 /minus /.notdef /Zcaron /zcaron
% 0x10
 /caron /dotlessi /dotlessj /ff
 /ffi /ffl /notequal /infinity
 /lessequal /greaterequal /partialdiff /summation
 /product /pi /grave /quotesingle
% 0x20
 /space /exclam /quotedbl /numbersign
 /dollar /percent /ampersand /quoteright
 /parenleft /parenright /asterisk /plus
 /comma /hyphen /period /slash
% 0x30
 /zero /one /two /three
 /four /five /six /seven
 /eight /nine /colon /semicolon
 /less /equal /greater /question
% 0x40
 /at /A /B /C
 /D /E /F /G
 /H /I /J /K
 /L /M /N /O
% 0x50
 /P /Q /R /S
 /T /U /V /W
 /X /Y /Z /bracketleft
 /backslash /bracketright /asciicircum /underscore
% 0x60
 /quoteleft /a /b /c
 /d /e /f /g
 /h /i /j /k
 /l /m /n /o
% 0x70
 /p /q /r /s
 /t /u /v /w
 /x /y /z /braceleft
 /bar /braceright /asciitilde /.notdef
% 0x80
 /Euro /integral /quotesinglbase /florin
 /quotedblbase /ellipsis /dagger /daggerdbl
 /circumflex /perthousand /Scaron /guilsinglleft
 /OE /Omega /radical /approxequal
% 0x90
 /.notdef /.notdef /.notdef /quotedblleft
 /quotedblright /bullet /endash /emdash
 /tilde /trademark /scaron /guilsinglright
 /oe /Delta /lozenge /Ydieresis
% 0xA0
 /.notdef /exclamdown /cent /sterling
 /currency /yen /brokenbar /section
 /dieresis /copyright /ordfeminine /guillemotleft
 /logicalnot /hyphen /registered /macron
% 0xD0
 /degree /plusminus /twosuperior /threesuperior
 /acute /mu /paragraph /periodcentered
 /cedilla /onesuperior /ordmasculine /guillemotright
 /onequarter /onehalf /threequarters /questiondown
% 0xC0
 /Agrave /Aacute /Acircumflex /Atilde
 /Adieresis /Aring /AE /Ccedilla
 /Egrave /Eacute /Ecircumflex /Edieresis
 /Igrave /Iacute /Icircumflex /Idieresis
% 0xD0
 /Eth /Ntilde /Ograve /Oacute
 /Ocircumflex /Otilde /Odieresis /multiply
 /Oslash /Ugrave /Uacute /Ucircumflex
 /Udieresis /Yacute /Thorn /germandbls
% 0xE0
 /agrave /aacute /acircumflex /atilde
 /adieresis /aring /ae /ccedilla
 /egrave /eacute /ecircumflex /edieresis
 /igrave /iacute /icircumflex /idieresis
% 0xF0
 /eth /ntilde /ograve /oacute
 /ocircumflex /otilde /odieresis /divide
 /oslash /ugrave /uacute /ucircumflex
 /udieresis /yacute /thorn /ydieresis
] def


%%EndProcSet
%%BeginProcSet: texps.pro 0 0
%!
TeXDict begin/rf{findfont dup length 1 add dict begin{1 index/FID ne 2
index/UniqueID ne and{def}{pop pop}ifelse}forall[1 index 0 6 -1 roll
exec 0 exch 5 -1 roll VResolution Resolution div mul neg 0 0]FontType 0
ne{/Metrics exch def dict begin Encoding{exch dup type/integertype ne{
pop pop 1 sub dup 0 le{pop}{[}ifelse}{FontMatrix 0 get div Metrics 0 get
div def}ifelse}forall Metrics/Metrics currentdict end def}{{1 index type
/nametype eq{exit}if exch pop}loop}ifelse[2 index currentdict end
definefont 3 -1 roll makefont/setfont cvx]cvx def}def/ObliqueSlant{dup
sin S cos div neg}B/SlantFont{4 index mul add}def/ExtendFont{3 -1 roll
mul exch}def/ReEncodeFont{CharStrings rcheck{/Encoding false def dup[
exch{dup CharStrings exch known not{pop/.notdef/Encoding true def}if}
forall Encoding{]exch pop}{cleartomark}ifelse}if/Encoding exch def}def
end

%%EndProcSet
%%BeginProcSet: special.pro 0 0
%!
TeXDict begin/SDict 200 dict N SDict begin/@SpecialDefaults{/hs 612 N
/vs 792 N/ho 0 N/vo 0 N/hsc 1 N/vsc 1 N/ang 0 N/CLIP 0 N/rwiSeen false N
/rhiSeen false N/letter{}N/note{}N/a4{}N/legal{}N}B/@scaleunit 100 N
/@hscale{@scaleunit div/hsc X}B/@vscale{@scaleunit div/vsc X}B/@hsize{
/hs X/CLIP 1 N}B/@vsize{/vs X/CLIP 1 N}B/@clip{/CLIP 2 N}B/@hoffset{/ho
X}B/@voffset{/vo X}B/@angle{/ang X}B/@rwi{10 div/rwi X/rwiSeen true N}B
/@rhi{10 div/rhi X/rhiSeen true N}B/@llx{/llx X}B/@lly{/lly X}B/@urx{
/urx X}B/@ury{/ury X}B/magscale true def end/@MacSetUp{userdict/md known
{userdict/md get type/dicttype eq{userdict begin md length 10 add md
maxlength ge{/md md dup length 20 add dict copy def}if end md begin
/letter{}N/note{}N/legal{}N/od{txpose 1 0 mtx defaultmatrix dtransform S
atan/pa X newpath clippath mark{transform{itransform moveto}}{transform{
itransform lineto}}{6 -2 roll transform 6 -2 roll transform 6 -2 roll
transform{itransform 6 2 roll itransform 6 2 roll itransform 6 2 roll
curveto}}{{closepath}}pathforall newpath counttomark array astore/gc xdf
pop ct 39 0 put 10 fz 0 fs 2 F/|______Courier fnt invertflag{PaintBlack}
if}N/txpose{pxs pys scale ppr aload pop por{noflips{pop S neg S TR pop 1
-1 scale}if xflip yflip and{pop S neg S TR 180 rotate 1 -1 scale ppr 3
get ppr 1 get neg sub neg ppr 2 get ppr 0 get neg sub neg TR}if xflip
yflip not and{pop S neg S TR pop 180 rotate ppr 3 get ppr 1 get neg sub
neg 0 TR}if yflip xflip not and{ppr 1 get neg ppr 0 get neg TR}if}{
noflips{TR pop pop 270 rotate 1 -1 scale}if xflip yflip and{TR pop pop
90 rotate 1 -1 scale ppr 3 get ppr 1 get neg sub neg ppr 2 get ppr 0 get
neg sub neg TR}if xflip yflip not and{TR pop pop 90 rotate ppr 3 get ppr
1 get neg sub neg 0 TR}if yflip xflip not and{TR pop pop 270 rotate ppr
2 get ppr 0 get neg sub neg 0 S TR}if}ifelse scaleby96{ppr aload pop 4
-1 roll add 2 div 3 1 roll add 2 div 2 copy TR .96 dup scale neg S neg S
TR}if}N/cp{pop pop showpage pm restore}N end}if}if}N/normalscale{
Resolution 72 div VResolution 72 div neg scale magscale{DVImag dup scale
}if 0 setgray}N/psfts{S 65781.76 div N}N/startTexFig{/psf$SavedState
save N userdict maxlength dict begin/magscale true def normalscale
currentpoint TR/psf$ury psfts/psf$urx psfts/psf$lly psfts/psf$llx psfts
/psf$y psfts/psf$x psfts currentpoint/psf$cy X/psf$cx X/psf$sx psf$x
psf$urx psf$llx sub div N/psf$sy psf$y psf$ury psf$lly sub div N psf$sx
psf$sy scale psf$cx psf$sx div psf$llx sub psf$cy psf$sy div psf$ury sub
TR/showpage{}N/erasepage{}N/setpagedevice{pop}N/copypage{}N/p 3 def
@MacSetUp}N/doclip{psf$llx psf$lly psf$urx psf$ury currentpoint 6 2 roll
newpath 4 copy 4 2 roll moveto 6 -1 roll S lineto S lineto S lineto
closepath clip newpath moveto}N/endTexFig{end psf$SavedState restore}N
/@beginspecial{SDict begin/SpecialSave save N gsave normalscale
currentpoint TR @SpecialDefaults count/ocount X/dcount countdictstack N}
N/@setspecial{CLIP 1 eq{newpath 0 0 moveto hs 0 rlineto 0 vs rlineto hs
neg 0 rlineto closepath clip}if ho vo TR hsc vsc scale ang rotate
rwiSeen{rwi urx llx sub div rhiSeen{rhi ury lly sub div}{dup}ifelse
scale llx neg lly neg TR}{rhiSeen{rhi ury lly sub div dup scale llx neg
lly neg TR}if}ifelse CLIP 2 eq{newpath llx lly moveto urx lly lineto urx
ury lineto llx ury lineto closepath clip}if/showpage{}N/erasepage{}N
/setpagedevice{pop}N/copypage{}N newpath}N/@endspecial{count ocount sub{
pop}repeat countdictstack dcount sub{end}repeat grestore SpecialSave
restore end}N/@defspecial{SDict begin}N/@fedspecial{end}B/li{lineto}B
/rl{rlineto}B/rc{rcurveto}B/np{/SaveX currentpoint/SaveY X N 1
setlinecap newpath}N/st{stroke SaveX SaveY moveto}N/fil{fill SaveX SaveY
moveto}N/ellipse{/endangle X/startangle X/yrad X/xrad X/savematrix
matrix currentmatrix N TR xrad yrad scale 0 0 1 startangle endangle arc
savematrix setmatrix}N end

%%EndProcSet
%%BeginProcSet: color.pro 0 0
%!
TeXDict begin/setcmykcolor where{pop}{/setcmykcolor{dup 10 eq{pop
setrgbcolor}{1 sub 4 1 roll 3{3 index add neg dup 0 lt{pop 0}if 3 1 roll
}repeat setrgbcolor pop}ifelse}B}ifelse/TeXcolorcmyk{setcmykcolor}def
/TeXcolorrgb{setrgbcolor}def/TeXcolorgrey{setgray}def/TeXcolorgray{
setgray}def/TeXcolorhsb{sethsbcolor}def/currentcmykcolor where{pop}{
/currentcmykcolor{currentrgbcolor 10}B}ifelse/DC{exch dup userdict exch
known{pop pop}{X}ifelse}B/GreenYellow{0.15 0 0.69 0 setcmykcolor}DC
/Yellow{0 0 1 0 setcmykcolor}DC/Goldenrod{0 0.10 0.84 0 setcmykcolor}DC
/Dandelion{0 0.29 0.84 0 setcmykcolor}DC/Apricot{0 0.32 0.52 0
setcmykcolor}DC/Peach{0 0.50 0.70 0 setcmykcolor}DC/Melon{0 0.46 0.50 0
setcmykcolor}DC/YellowOrange{0 0.42 1 0 setcmykcolor}DC/Orange{0 0.61
0.87 0 setcmykcolor}DC/BurntOrange{0 0.51 1 0 setcmykcolor}DC
/Bittersweet{0 0.75 1 0.24 setcmykcolor}DC/RedOrange{0 0.77 0.87 0
setcmykcolor}DC/Mahogany{0 0.85 0.87 0.35 setcmykcolor}DC/Maroon{0 0.87
0.68 0.32 setcmykcolor}DC/BrickRed{0 0.89 0.94 0.28 setcmykcolor}DC/Red{
0 1 1 0 setcmykcolor}DC/OrangeRed{0 1 0.50 0 setcmykcolor}DC/RubineRed{
0 1 0.13 0 setcmykcolor}DC/WildStrawberry{0 0.96 0.39 0 setcmykcolor}DC
/Salmon{0 0.53 0.38 0 setcmykcolor}DC/CarnationPink{0 0.63 0 0
setcmykcolor}DC/Magenta{0 1 0 0 setcmykcolor}DC/VioletRed{0 0.81 0 0
setcmykcolor}DC/Rhodamine{0 0.82 0 0 setcmykcolor}DC/Mulberry{0.34 0.90
0 0.02 setcmykcolor}DC/RedViolet{0.07 0.90 0 0.34 setcmykcolor}DC
/Fuchsia{0.47 0.91 0 0.08 setcmykcolor}DC/Lavender{0 0.48 0 0
setcmykcolor}DC/Thistle{0.12 0.59 0 0 setcmykcolor}DC/Orchid{0.32 0.64 0
0 setcmykcolor}DC/DarkOrchid{0.40 0.80 0.20 0 setcmykcolor}DC/Purple{
0.45 0.86 0 0 setcmykcolor}DC/Plum{0.50 1 0 0 setcmykcolor}DC/Violet{
0.79 0.88 0 0 setcmykcolor}DC/RoyalPurple{0.75 0.90 0 0 setcmykcolor}DC
/BlueViolet{0.86 0.91 0 0.04 setcmykcolor}DC/Periwinkle{0.57 0.55 0 0
setcmykcolor}DC/CadetBlue{0.62 0.57 0.23 0 setcmykcolor}DC
/CornflowerBlue{0.65 0.13 0 0 setcmykcolor}DC/MidnightBlue{0.98 0.13 0
0.43 setcmykcolor}DC/NavyBlue{0.94 0.54 0 0 setcmykcolor}DC/RoyalBlue{1
0.50 0 0 setcmykcolor}DC/Blue{1 1 0 0 setcmykcolor}DC/Cerulean{0.94 0.11
0 0 setcmykcolor}DC/Cyan{1 0 0 0 setcmykcolor}DC/ProcessBlue{0.96 0 0 0
setcmykcolor}DC/SkyBlue{0.62 0 0.12 0 setcmykcolor}DC/Turquoise{0.85 0
0.20 0 setcmykcolor}DC/TealBlue{0.86 0 0.34 0.02 setcmykcolor}DC
/Aquamarine{0.82 0 0.30 0 setcmykcolor}DC/BlueGreen{0.85 0 0.33 0
setcmykcolor}DC/Emerald{1 0 0.50 0 setcmykcolor}DC/JungleGreen{0.99 0
0.52 0 setcmykcolor}DC/SeaGreen{0.69 0 0.50 0 setcmykcolor}DC/Green{1 0
1 0 setcmykcolor}DC/ForestGreen{0.91 0 0.88 0.12 setcmykcolor}DC
/PineGreen{0.92 0 0.59 0.25 setcmykcolor}DC/LimeGreen{0.50 0 1 0
setcmykcolor}DC/YellowGreen{0.44 0 0.74 0 setcmykcolor}DC/SpringGreen{
0.26 0 0.76 0 setcmykcolor}DC/OliveGreen{0.64 0 0.95 0.40 setcmykcolor}
DC/RawSienna{0 0.72 1 0.45 setcmykcolor}DC/Sepia{0 0.83 1 0.70
setcmykcolor}DC/Brown{0 0.81 1 0.60 setcmykcolor}DC/Tan{0.14 0.42 0.56 0
setcmykcolor}DC/Gray{0 0 0 0.50 setcmykcolor}DC/Black{0 0 0 1
setcmykcolor}DC/White{0 0 0 0 setcmykcolor}DC end

%%EndProcSet
%%BeginFont: CMSY10
%!PS-AdobeFont-1.1: CMSY10 1.0
%%CreationDate: 1991 Aug 15 07:20:57
% Copyright (C) 1997 American Mathematical Society. All Rights Reserved.
11 dict begin
/FontInfo 7 dict dup begin
/version (1.0) readonly def
/Notice (Copyright (C) 1997 American Mathematical Society. All Rights Reserved) readonly def
/FullName (CMSY10) readonly def
/FamilyName (Computer Modern) readonly def
/Weight (Medium) readonly def
/ItalicAngle -14.035 def
/isFixedPitch false def
end readonly def
/FontName /CMSY10 def
/PaintType 0 def
/FontType 1 def
/FontMatrix [0.001 0 0 0.001 0 0] readonly def
/Encoding 256 array
0 1 255 {1 index exch /.notdef put} for
dup 3 /asteriskmath put
dup 15 /bullet put
readonly def
/FontBBox{-29 -960 1116 775}readonly def
currentdict end
currentfile eexec
D9D66F633B846A97B686A97E45A3D0AA052F09F9C8ADE9D907C058B87E9B6964
7D53359E51216774A4EAA1E2B58EC3176BD1184A633B951372B4198D4E8C5EF4
A213ACB58AA0A658908035BF2ED8531779838A960DFE2B27EA49C37156989C85
E21B3ABF72E39A89232CD9F4237FC80C9E64E8425AA3BEF7DED60B122A52922A
221A37D9A807DD01161779DDE7D31FF2B87F97C73D63EECDDA4C49501773468A
27D1663E0B62F461F6E40A5D6676D1D12B51E641C1D4E8E2771864FC104F8CBF
5B78EC1D88228725F1C453A678F58A7E1B7BD7CA700717D288EB8DA1F57C4F09
0ABF1D42C5DDD0C384C7E22F8F8047BE1D4C1CC8E33368FB1AC82B4E96146730
DE3302B2E6B819CB6AE455B1AF3187FFE8071AA57EF8A6616B9CB7941D44EC7A
71A7BB3DF755178D7D2E4BB69859EFA4BBC30BD6BB1531133FD4D9438FF99F09
4ECC068A324D75B5F696B8688EEB2F17E5ED34CCD6D047A4E3806D000C199D7C
515DB70A8D4F6146FE068DC1E5DE8BC57036431151EC603C8BCFE359BBD953AD
5F3D998FF41E4B1CF7C81FC78F5D909D12694A1D39319370187F4A40DFC3AF7D
B2B0EAECCD0B886C1AAA126D97341677BD38BAC71840039357F57482A7E3E463
EA31273B4DE501636F5C9EFB4C242D5F3852C93489628BE262C825B8D9EF2CB6
F066235B03777EA7CCA1C38BA2B5D0B0F30FC550919B9AD85D1AFCCC881C2613
84868AF154AAA663E3984751A2F262B7E68F255DA4B9E6E62771EDC857A3505B
AA582ED9B7B5D421F469AC9A20016B0C06AA4186EB208D78269093F18DC261E3
3A36B86D8C454F392428C381C841867B8F4BD92DF4E04CC1E91EBC74CDBE0B2D
81A6F6F93EA3AE326C1124B259DBDEDC2F73E482342D7890D6DF1A3BC7444A9C
6C00F13669690204E9C2F75A2CD0BF1E997A12CF4A4202C8C61361FFC229917B
A281E88C9B5BFB6D00A36EF654793120501D8E13E6C78C1165A57D2ACF3FD246
A986A0B772B141FC9CCB02CA46A6AAA8137377AFF4E7B24A86EE44D43A43CD74
016F1C250692AA64C6038F9F799D0419D7E73C018D45AB30205133951C014B15
4A0D62F39E7E10336B734657548F
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
cleartomark
%%EndFont 
TeXDict begin 39139632 55387786 1000 600 600 (flowreplay.dvi)
@start /Fa 139[23 4[42 42 1[23 37 1[23 1[42 3[37 42 52[28
45[{TeXBase1Encoding ReEncodeFont}10 83.022 /Times-Italic
rf /Fb 130[42 1[42 42 42 42 1[42 42 42 42 42 1[42 42
42 42 42 42 1[42 42 42 42 42 42 42 42 42 1[42 9[42 42
42 42 1[42 42 42 1[42 42 1[42 1[42 1[42 42 42 42 3[42
42 42 42 9[42 42 42 42 42 42 1[42 42 42 1[42 3[42 42
33[{.85 ExtendFont TeXBase1Encoding ReEncodeFont}57 83.022
/Courier rf /Fc 240[42 11[42 3[{}2 83.022 /CMSY10 rf
/Fd 107[29 29 20[36 4[33 33 48 33 33 18 26 22 33 33 33
33 52 18 33 18 18 33 33 22 29 33 29 33 29 23[22 7[48
6[18 2[33 4[33 2[18 17 1[17 2[22 22 40[{TeXBase1Encoding ReEncodeFont}
38 66.4176 /Times-Roman rf /Fe 199[25 25 25 25 25 25
25 25 49[{TeXBase1Encoding ReEncodeFont}8 49.8132 /Times-Roman
rf /Ff 133[44 50 2[50 55 33 39 44 55 55 50 55 83 28 55
1[28 55 50 33 44 55 44 1[50 9[100 2[66 55 72 1[61 2[94
3[39 78 1[61 1[72 72 66 11[50 1[50 50 50 50 1[28 25 33
42[55 2[{TeXBase1Encoding ReEncodeFont}43 99.6264 /Times-Bold
rf /Fg 199[31 31 31 31 31 31 31 31 49[{TeXBase1Encoding ReEncodeFont}8
61.4362 /Times-Roman rf /Fh 136[86 60 66 40 47 53 1[66
60 66 100 33 2[33 66 60 1[53 66 53 1[60 12[80 3[73 93
1[113 3[47 2[73 1[86 13[60 60 60 60 60 60 3[40 41[66
3[{TeXBase1Encoding ReEncodeFont}33 119.552 /Times-Bold
rf /Fi 107[37 37 24[37 42 42 60 42 42 23 32 28 42 42
42 42 65 23 42 23 23 42 42 28 37 42 37 42 37 1[42 5[60
1[78 60 60 51 46 55 1[46 60 60 74 51 60 1[28 60 60 46
51 60 55 55 60 1[37 3[23 23 42 42 42 42 42 42 42 42 42
42 23 21 28 21 47 1[28 28 28 4[34 30[46 46 2[{
TeXBase1Encoding ReEncodeFont}75 83.022 /Times-Roman
rf /Fj 134[50 3[50 28 39 33 1[50 50 50 4[28 50 2[44 50
44 50 44 12[61 4[72 2[61 6[61 3[72 6[28 6[50 50 1[50
28 25 1[25 41[55 2[{TeXBase1Encoding ReEncodeFont}28
99.6264 /Times-Roman rf /Fk 134[72 1[104 2[40 56 48 1[72
72 72 1[40 2[40 1[72 1[64 3[64 18[104 7[80 1[104 68[{
TeXBase1Encoding ReEncodeFont}16 143.462 /Times-Roman
rf end
%%EndProlog
%%BeginSetup
%%Feature: *Resolution 600dpi
TeXDict begin
%%PaperSize: A4
 end
%%EndSetup
%%Page: 1 1
TeXDict begin 1 0 bop Black Black Black Black 0 TeXcolorgray
1219 68 a Fk(Flo)l(wreplay)33 b(Design)i(Notes)p Black
0 TeXcolorgray 1667 359 a Fj(Aaron)25 b(T)l(urner)p Black
0 TeXcolorgray 1622 475 a(http://syn\002n.net/)p Black
0 TeXcolorgray 1708 718 a(Last)f(Edited:)p Black 0 TeXcolorgray
1603 818 a(October)h(23,)f(2003)p Black Black 1929 5895
a Fi(1)p Black eop end
%%Page: 2 2
TeXDict begin 2 1 bop Black Black -364 -281 a Fh(1)p
0 TeXcolorgray 120 w(Ov)o(er)o(view)p Black 0 TeXcolorgray
-364 -54 a Fi(Tcpreplay)p Black -30 x Fg(1)p 0 TeXcolorgray
36 -54 a Fi(w)o(as)28 b(designed)e(to)i(replay)e(traf)n(\002c)i(pre)n
(viously)d(captured)h(in)i(the)f(pcap)g(format)f(back)h(onto)g(the)g
(wire)h(for)f(testing)g(NIDS)h(and)f(other)g(passi)n(v)o(e)-364
46 y(de)n(vices.)35 b(Ov)o(er)24 b(time,)g(it)h(w)o(as)f(enhanced)e(to)
i(be)g(able)g(to)g(test)g(in-line)g(netw)o(ork)e(de)n(vices.)35
b(Ho)n(we)n(v)o(er)m(,)23 b(a)h(re-occurring)d(feature)i(request)g(for)
g(tcpreplay)f(is)j(to)-364 146 y(connect)19 b(to)g(a)h(serv)o(er)f(in)h
(order)e(to)i(test)g(applications)f(and)g(host)g(TCP/IP)i(stacks.)k(It)
20 b(w)o(as)g(determined)e(early)h(on,)g(that)h(adding)e(this)i
(feature)f(to)g(tcpreplay)g(w)o(as)-364 245 y(f)o(ar)h(too)g(comple)o
(x,)e(so)j(I)f(decided)f(to)i(create)f(a)g(ne)n(w)g(tool)g
(speci\002cally)g(designed)f(for)g(this.)p Black 0 TeXcolorgray
-364 386 a(Flo)n(wreplay)24 b(is)h(designed)f(to)g(replay)g(traf)n
(\002c)h(at)g(Layer)f(4)h(or)f(7)h(depending)d(on)i(the)h(protocol)e
(rather)h(then)g(at)h(Layer)f(2)h(lik)o(e)g(tcpreplay)e(does.)38
b(This)25 b(allo)n(ws)-364 486 y(\003o)n(wreplay)d(to)h(connect)f(to)h
(one)f(or)h(more)f(serv)o(ers)g(using)h(a)g(pcap)f(sa)n(v)o(e\002le)i
(as)f(the)g(basis)h(of)f(the)g(connections.)31 b(Hence,)23
b(\003o)n(wreplay)e(allo)n(ws)j(the)f(testing)g(of)-364
586 y(applications)c(running)f(on)i(real)g(serv)o(ers)g(rather)f(then)h
(passi)n(v)o(e)g(de)n(vices.)p Black -364 903 a Fh(2)p
0 TeXcolorgray 120 w(F)m(eatur)n(es)p Black -364 1147
a Ff(2.1)p 0 TeXcolorgray 99 w(Requir)n(ements)p Black
Black -260 1332 a Fi(1.)p Black 0 TeXcolorgray 41 w(Full)g(TCP/IP)h
(support,)e(including)f(IP)j(fragments)e(and)g(TCP)i(stream)f
(reassembly)-5 b(.)p Black Black -260 1490 a(2.)p Black
0 TeXcolorgray 41 w(Support)18 b(replaying)h(TCP)i(and)e(UDP)i(\003o)n
(ws.)p Black Black -260 1647 a(3.)p Black 0 TeXcolorgray
41 w(Code)f(should)f(handle)g(each)h(\003o)n(w/service)f(independently)
-5 b(.)p Black Black -260 1805 a(4.)p Black 0 TeXcolorgray
41 w(Should)19 b(be)h(able)g(to)g(connect)f(to)i(the)f(serv)o(er\(s\))f
(in)h(the)g(pcap)g(\002le)h(or)f(to)g(a)h(user)f(speci\002ed)g(IP)g
(address.)p Black Black -260 1963 a(5.)p Black 0 TeXcolorgray
41 w(Support)e(a)j(plug-in)e(architecture)f(to)j(allo)n(w)f(adding)f
(application)f(layer)i(intelligence.)p Black Black -260
2120 a(6.)p Black 0 TeXcolorgray 41 w(Plug-ins)f(must)i(be)f(able)g(to)
g(support)f(multi-\003o)n(w)g(protocols)g(lik)o(e)h(FTP)-9
b(.)p Black Black -260 2278 a(7.)p Black 0 TeXcolorgray
41 w(Ship)20 b(with)g(a)h(def)o(ault)e(plug-in)g(which)h(will)g(w)o
(ork)g(\223well)h(enough\224)d(for)h(simple)h(single-\003o)n(w)g
(protocols)e(lik)o(e)j(HTTP)f(and)g(telnet.)p Black Black
-260 2436 a(8.)p Black 0 TeXcolorgray 41 w(Flo)n(ws)g(being)g(replayed)
e(\223correctly\224)h(is)i(more)e(important)g(then)h(performance)d
(\(Mbps\).)p Black Black -260 2593 a(9.)p Black 0 TeXcolorgray
41 w(Portable)i(to)i(run)e(on)h(common)e(\003a)n(v)n(ors)j(of)e(Unix)h
(and)g(Unix-lik)o(e)f(systems.)p Black -364 2869 a Ff(2.2)p
0 TeXcolorgray 99 w(W)n(ishes)p Black Black -260 3054
a Fi(1.)p Black 0 TeXcolorgray 41 w(Support)f(clients)j(connecting)d
(to)i(\003o)n(wreplay)f(on)h(a)h(limited)f(basis.)25
b(Flo)n(wreplay)19 b(w)o(ould)g(replay)h(the)g(serv)o(er)f(side)i(of)f
(the)g(connection.)p Black Black -260 3211 a(2.)p Black
0 TeXcolorgray 41 w(Support)e(other)i(IP)g(based)g(traf)n(\002c)g
(\(ICMP)-9 b(,)20 b(VRRP)-9 b(,)21 b(OSPF)-7 b(,)21 b(etc\))g(via)f
(plug-ins.)p Black Black -260 3369 a(3.)p Black 0 TeXcolorgray
41 w(Support)e(non-IP)h(traf)n(\002c)h(\(ARP)-9 b(,)21
b(STP)-9 b(,)20 b(CDP)-9 b(,)21 b(etc\))f(via)g(plug-ins.)p
Black Black -260 3527 a(4.)p Black 0 TeXcolorgray 41
w(Limit)g(which)g(\003o)n(ws)g(are)g(replayed)f(using)h(user)g
(de\002ned)f(\002lters.)26 b(\(bpf)19 b(\002lter)h(syntax?\))p
Black Black -260 3684 a(5.)p Black 0 TeXcolorgray 41
w(Process)g(pcap)g(\002les)h(directly)e(with)i(no)e(intermediary)f
(\002le)j(con)m(v)o(ersions.)p Black Black -260 3842
a(6.)p Black 0 TeXcolorgray 41 w(Should)e(be)h(able)g(to)g(scale)h(to)f
(pcap)g(\002les)h(in)f(the)h(100')-5 b(s)19 b(of)h(MB)h(in)f(size)h
(and)f(100+)f(simultaneous)g(\003o)n(ws)i(on)e(a)i(P3)f(500MHz)f(w/)i
(256MB)f(of)f(RAM.)p Black -364 4160 a Fh(3)p 0 TeXcolorgray
120 w(Design)30 b(Thoughts)p Black -364 4404 a Ff(3.1)p
0 TeXcolorgray 99 w(Sending)d(and)e(Recei)o(ving)g(traf\002c)p
Black 0 TeXcolorgray -364 4601 a Fi(Flo)n(wreplay)19
b(must)h(be)g(able)g(to)h(process)f(multiple)f(connections)f(to)j(one)e
(or)h(more)g(de)n(vices.)k(There)19 b(are)i(tw)o(o)f(options:)p
Black Black -260 4804 a(1.)p Black 0 TeXcolorgray 41
w(Use)h(sock)o(ets)p Black -30 x Fg(2)p 0 TeXcolorgray
293 4804 a Fi(to)f(send)g(and)g(recei)n(v)o(e)f(data)p
Black Black -260 4962 a(2.)p Black 0 TeXcolorgray 41
w(Use)i(libpcap)p Black -30 x Fg(3)p 0 TeXcolorgray 294
4962 a Fi(to)f(recei)n(v)o(e)f(pack)o(ets)h(and)g(libnet)p
Black -30 x Fg(4)p 0 TeXcolorgray 1290 4962 a Fi(to)h(send)f(pack)o
(ets)p Black 0 TeXcolorgray -364 5165 a(Although)k(using)h
(libpcap/libnet)e(w)o(ould)i(allo)n(w)g(more)f(simultaneous)g
(connections)g(and)h(greater)f(\003e)o(xibility)-5 b(,)25
b(there)g(w)o(ould)g(be)g(a)h(v)o(ery)e(high)g(comple)o(xity)-364
5265 y(cost)d(associated)f(with)g(it.)26 b(W)m(ith)20
b(that)g(in)h(mind,)e(I')l(v)o(e)g(decided)g(to)h(use)h(sock)o(ets)f
(to)g(send)g(and)g(recei)n(v)o(e)f(data.)p Black Black
-364 5322 1851 4 v -273 5377 a Fe(1)p 0 TeXcolorgray
-244 5401 a Fd(http://tcpreplay)l(.sourcefo)q(r)o(ge.ne)q(t/)p
Black -273 5458 a Fe(2)p 0 TeXcolorgray -244 5483 a Fd(sock)o(et\(2\))p
Black -273 5540 a Fe(3)p 0 TeXcolorgray -244 5564 a Fd(http://www)l
(.tcpdump.or)o(g/)p Black -273 5622 a Fe(4)p 0 TeXcolorgray
-244 5646 a Fd(http://www)l(.pack)o(etf)o(actor)q(y)l(.net/)q(proj)q
(ec)q(ts/l)q(ib)q(net)q(/)p Black Black Black 1929 5895
a Fi(2)p Black eop end
%%Page: 3 3
TeXDict begin 3 2 bop Black Black -364 -281 a Ff(3.2)p
0 TeXcolorgray 99 w(Handling)25 b(Multiple)g(Connections)p
Black 0 TeXcolorgray -364 -75 a Fi(Because)19 b(a)g(pcap)e(\002le)i
(can)f(contain)g(multiple)f(simultaneous)h(\003o)n(ws,)g(we)h(need)f
(to)g(be)h(able)f(to)g(support)f(that)i(too.)24 b(The)18
b(biggest)f(problem)g(with)i(this)g(is)g(reading)-364
24 y(pack)o(et)h(data)g(in)g(a)h(dif)n(ferent)d(order)h(then)h(stored)g
(in)g(the)g(pcap)g(\002le.)p Black 0 TeXcolorgray -364
174 a(Reading)f(and)h(writing)f(to)h(multiple)f(sock)o(ets)h(is)g(easy)
g(with)g(select\(\))g(or)g(poll\(\),)e(ho)n(we)n(v)o(er)g(a)i(pcap)f
(\002le)i(has)f(it')-5 b(s)21 b(data)e(stored)h(serially)-5
b(,)19 b(b)n(ut)h(we)g(need)f(to)h(access)-364 273 y(it)h(randomly)-5
b(.)24 b(There)19 b(are)i(a)g(number)d(of)j(possible)f(solutions)g(for)
g(this)h(such)f(as)h(caching)f(pack)o(ets)g(in)g(RAM)i(where)d(the)o(y)
h(can)h(be)f(accessed)h(more)e(randomly)-5 b(,)-364 373
y(creating)21 b(an)h(inde)o(x)f(of)h(the)g(pack)o(ets)g(in)h(the)f
(pcap)f(\002le,)i(or)f(con)m(v)o(erting)d(the)k(pcap)e(\002le)i(to)f
(another)f(format)g(altogether)-5 b(.)30 b(Alternati)n(v)o(ely)-5
b(,)20 b(I')l(v)o(e)h(started)h(looking)-364 473 y(at)f(libpcapna)n(v)p
Black -30 x Fg(5)p 0 TeXcolorgray 135 473 a Fi(as)g(an)f(alternate)g
(means)g(to)g(na)n(vigate)f(a)i(pcap)e(\002le)i(and)f(process)f(pack)o
(ets)h(out)g(of)g(order)-5 b(.)p Black -364 760 a Ff(3.3)p
0 TeXcolorgray 99 w(Data)25 b(Synchr)n(onization)p Black
0 TeXcolorgray -364 966 a Fi(Kno)n(wing)c(when)g(to)i(start)f(sending)f
(client)h(traf)n(\002c)g(in)g(response)g(to)g(the)g(serv)o(er)f(will)i
(be)f("trick)o(y".)30 b(W)m(ithout)21 b(understanding)e(the)j(actual)g
(protocol)f(in)m(v)n(olv)o(ed,)-364 1065 y(probably)e(the)h(best)i
(general)d(solution)h(is)i(w)o(aiting)e(for)g(a)i(gi)n(v)o(en)d(period)
h(of)g(time)h(after)f(no)h(more)f(data)g(from)g(the)h(serv)o(er)f(has)h
(been)f(recei)n(v)o(ed.)25 b(Not)c(sure)f(what)-364 1165
y(to)j(do)f(if)g(the)h(client)f(traf)n(\002c)g(doesn')o(t)f(elicit)i(a)
g(response)e(from)g(the)i(serv)o(er)e(\(implement)g(some)h(kind)g(of)g
(timeout?\).)30 b(This)22 b(will)h(be)g(the)f(basis)h(for)f(the)g(def)o
(ault)-364 1264 y(plug-in.)p Black -364 1552 a Ff(3.4)p
0 TeXcolorgray 99 w(TCP/IP)p Black 0 TeXcolorgray -364
1757 a Fi(Dealing)i(with)g(IP)h(fragmentation)c(and)j(TCP)h(stream)f
(reassembly)g(will)g(be)h(another)d(really)i(comple)o(x)f(problem.)35
b(W)-7 b(e')l(re)24 b(basically)g(talking)g(about)f(imple-)-364
1857 y(menting)d(a)i(signi\002cant)f(portion)f(of)h(a)h(TCP/IP)g
(stack.)28 b(One)22 b(thought)d(is)k(to)e(use)h(libnids)p
Black -30 x Fg(6)p 0 TeXcolorgray 2276 1857 a Fi(which)f(basically)g
(implements)f(a)i(Linux)e(2.0.37)g(TCP/IP)i(stack)f(in)-364
1957 y(user)n(-space.)j(Other)c(solutions)g(include)f(porting)g(a)h
(TCP/IP)h(stack)f(from)g(Open/Net/FreeBSD)f(or)h(writing)g(our)f(o)n
(wn)h(custom)f(stack)i(from)e(scratch.)p Black -364 2287
a Fh(4)p 0 TeXcolorgray 120 w(Multiple)31 b(Independent)h(Flo)o(ws)p
Black 0 TeXcolorgray -364 2522 a Fi(The)23 b(biggest)g(asynchronous)e
(problem,)i(that)g(pcap)g(\002les)i(are)e(serial,)i(has)e(to)h(be)g
(solv)o(ed)e(in)i(a)g(scaleable)f(manner)-5 b(.)35 b(Not)23
b(much)g(can)g(be)h(assumed)f(about)f(the)-364 2622 y(netw)o(ork)d
(traf)n(\002c)h(contained)f(in)h(a)h(pcap)e(sa)n(v)o(e\002le)i(other)e
(then)h(Murphy')-5 b(s)18 b(La)o(w)i(will)h(be)f(in)g(ef)n(fect.)25
b(This)20 b(means)g(we')o(ll)h(ha)n(v)o(e)e(to)h(deal)h(with:)p
Black Black -239 2854 a Fc(\017)p Black 0 TeXcolorgray
41 w Fi(Thousands)d(of)i(small)h(simultaneous)e(\003o)n(ws)h
(\(captured)f(on)g(a)i(b)n(usy)f(netw)o(ork\))p Black
Black -239 3020 a Fc(\017)p Black 0 TeXcolorgray 41 w
Fi(Flo)n(ws)g(which)g(\223hang\224)f(mid-stream)g(\(an)h(e)o(xploit)f
(against)g(a)i(serv)o(er)e(causes)i(it)g(to)f(crash\))p
Black Black -239 3186 a Fc(\017)p Black 0 TeXcolorgray
41 w Fi(Flo)n(ws)g(which)g(contain)f(lar)o(ge)g(quantities)h(of)g(data)
g(\(FTP)h(transfers)e(of)h(ISO')-5 b(s)21 b(for)e(e)o(xample\))p
Black 0 TeXcolorgray -364 3419 a(Ho)n(w)h(we)h(implement)e(parallel)h
(processing)e(of)i(the)g(pcap)g(sa)n(v)o(e\002le)g(will)h(dramatically)
e(ef)n(fect)h(ho)n(w)f(well)i(we)g(can)f(scale.)25 b(A)c(fe)n(w)f
(considerations:)p Black Black -239 3651 a Fc(\017)p
Black 41 w Fi(Most)i(Unix)g(systems)h(limit)g(the)f(maximum)e(number)h
(of)h(open)f(\002le)i(descriptors)e(a)h(single)h(process)e(can)h(ha)n
(v)o(e.)31 b(Generally)21 b(speaking)g(this)i(shouldn')o(t)-156
3751 y(be)d(a)h(problem)d(e)o(xcept)h(for)h(highly)f(parallel)g(pcap')
-5 b(s.)p Black -239 3917 a Fc(\017)p Black 41 w Fi(While)20
b(RAM)h(isn')o(t)f(limitless,)h(we)g(can)f(use)g(mmap\(\))f(to)h(get)g
(around)f(this.)p Black -239 4083 a Fc(\017)p Black 41
w Fi(Man)o(y)g(Unix)h(systems)g(ha)n(v)o(e)g(enhanced)e(solutions)i(to)
g(poll\(\))f(which)h(will)h(impro)o(v)o(e)d(\003o)n(w)i(management.)
-364 4370 y Ff(4.1)p 0 TeXcolorgray 99 w(IP)25 b(Fragments)g(and)h(TCP)
f(Str)n(eams)p Black 0 TeXcolorgray -364 4576 a Fi(There)20
b(are)g(\002)n(v)o(e)g(major)f(complications)g(with)h(\003o)n(wreplay:)
p Black Black -260 4808 a(1.)p Black 0 TeXcolorgray 41
w(The)f(IP)h(datagrams)f(may)g(be)h(fragmented-)d(we)j(w)o(on')o(t)f
(be)g(able)h(to)g(use)g(the)g(standard)e(5-tuple)h(\(src/dst)h(IP)-9
b(,)19 b(src/dst)h(port,)f(protocol\))f(to)i(lookup)e(which)-156
4908 y(\003o)n(w)i(a)h(pack)o(et)e(belongs)g(to.)p Black
Black -260 5074 a(2.)p Black 0 TeXcolorgray 41 w(IP)h(fragments)f(may)h
(arri)n(v)o(e)f(out)h(of)g(order)f(which)g(will)i(complicate)e
(ordering)f(of)i(data)g(to)h(be)f(sent.)p Black Black
-260 5240 a(3.)p Black 0 TeXcolorgray 41 w(The)g(TCP)h(se)o(gments)e
(may)h(arri)n(v)o(e)f(out)h(of)g(order)f(which)g(will)i(complicate)e
(ordering)f(of)i(data)g(to)h(be)f(sent.)p Black Black
-260 5406 a(4.)p Black 0 TeXcolorgray 41 w(P)o(ack)o(ets)g(may)g(be)g
(missing)g(in)g(the)h(pcap)e(\002le)i(because)e(the)o(y)h(were)g
(dropped)e(during)g(capture.)p Black Black -364 5477
1851 4 v -273 5533 a Fe(5)-244 5557 y Fd(http://netdude.sourcefor)o(ge)
q(.net/)-273 5614 y Fe(6)p 0 TeXcolorgray -244 5638 a
Fd(http://www)l(.a)o(v)o(et.com.pl/~ner)o(gal/lib)q(nid)q(s/)p
Black Black Black 1929 5895 a Fi(3)p Black eop end
%%Page: 4 4
TeXDict begin 4 3 bop Black Black Black -260 -281 a Fi(5.)p
Black 0 TeXcolorgray 41 w(There)19 b(are)h(tools)g(lik)o(e)h
(fragrouter)d(which)h(intentionally)g(create)h(non-deterministic)d
(situations.)p Black 0 TeXcolorgray -364 -86 a(First)k(of)n(f,)e(I')l
(v)o(e)g(decided,)g(that)h(I'm)g(not)g(going)f(to)h(w)o(orry)f(about)g
(fragrouter)f(or)i(it')-5 b(s)21 b(cousins.)k(I')o(ll)20
b(handle)f(non-deterministic)e(situations)j(one)g(and)g(only)f(one)-364
14 y(w)o(ay)-5 b(,)23 b(so)g(that)g(the)g(w)o(ay)g(\003o)n(wreplay)e
(handles)h(the)h(traf)n(\002c)f(will)h(be)g(deterministic.)32
b(Perhaps,)22 b(I')o(ll)h(mak)o(e)g(it)g(easy)g(for)f(others)g(to)h
(write)g(a)g(plug-in)e(which)i(will)-364 113 y(change)c(it,)i(b)n(ut)f
(that')-5 b(s)21 b(not)e(something)g(I'm)h(going)f(to)h(concern)f
(myself)g(with)i(no)n(w)-5 b(.)p Black 0 TeXcolorgray
-364 252 a(Missing)28 b(pack)o(ets)f(in)h(the)g(pcap)f(\002le)h(will)h
(probably)c(mak)o(e)i(that)h(\003o)n(w)g(unplayable.)45
b(There)27 b(are)h(proabably)d(certain)i(situation)h(where)f(we)h(can)f
(mak)o(e)g(an)-364 352 y(educated)19 b(guess,)h(b)n(ut)g(this)h(is)g(f)
o(ar)f(too)g(comple)o(x)e(to)j(w)o(orry)e(about)g(for)h(the)g(\002rst)h
(stable)f(release.)p Black 0 TeXcolorgray -364 491 a(That)i(still)h
(lea)n(v)o(es)e(creating)g(a)h(basic)g(TCP/IP)h(stack)e(in)h(user)g
(space.)29 b(The)22 b(good)e(ne)n(ws)i(it)g(that)g(there)f(is)i
(already)e(a)h(library)f(which)g(does)g(this)h(called)g(libnids.)-364
590 y(As)f(of)f(v)o(ersion)f(1.17,)g(libnids)h(can)g(process)f(pack)o
(ets)h(from)f(a)i(pcap)f(sa)n(v)o(e\002le)g(\(it')-5
b(s)21 b(not)f(documented)d(in)k(the)f(man)g(page,)f(b)n(ut)h(the)g
(code)g(is)h(there\).)p Black 0 TeXcolorgray -364 729
a(A)27 b(potential)e(problem)g(with)h(libnids)g(though)e(is)j(that)f
(it)h(has)g(to)f(maintain)f(it')-5 b(s)28 b(o)n(wn)d(state/cache)h
(system.)43 b(This)26 b(not)g(only)g(means)f(additional)g(o)o(v)o
(erhead,)-364 828 y(b)n(ut)c(jumping)e(around)h(in)h(the)g(pcap)f
(\002le)i(as)f(I'm)g(planning)e(on)h(doing)g(to)h(handle)f(multiple)g
(simultaneous)g(\003o)n(ws)h(is)h(lik)o(ely)f(to)g(really)g(confuse)e
(libnids')i(state)-364 928 y(engine.)32 b(Also,)24 b(libnids)e(is)i
(licensed)e(under)g(the)h(GPL,)f(b)n(ut)h(I)g(w)o(ant)g(\003o)n
(wreplay)f(released)g(under)f(a)j(BSD-lik)o(e)f(license;)h(I)f(need)f
(to)h(research)f(if)h(the)g(tw)o(o)g(are)-364 1028 y(compatible)c(in)h
(this)h(w)o(ay)-5 b(.)p Black 0 TeXcolorgray -364 1166
a(Possible)21 b(solutions:)p Black Black -239 1361 a
Fc(\017)p Black 0 TeXcolorgray 41 w Fi(De)n(v)o(eloping)d(a)i(custom)g
(wedge)f(between)h(the)g(capture)f(\002le)i(and)e(libnids)h(which)g
(will)h(cause)f(each)g(pack)o(et)f(to)i(only)e(be)h(processed)f(a)i
(single)f(time.)p Black Black -239 1517 a Fc(\017)p Black
0 TeXcolorgray 41 w Fi(Use)h(libnids)e(to)i(process)f(the)g(pcap)f
(\002le)i(into)f(a)h(ne)n(w)f(\003o)n(w-based)f(format,)f(ef)n(fecti)n
(v)o(ely)h(putting)g(the)h(TCP/IP)h(stack)f(into)g(a)h(dedicated)e
(utility)-5 b(.)p Black Black -239 1672 a Fc(\017)p Black
0 TeXcolorgray 41 w Fi(De)n(v)o(elop)18 b(a)j(custom)f(user)n(-space)f
(TCP/IP)i(stack,)f(perhaps)f(based)h(on)g(a)g(BSD)i(TCP/IP)e(stack,)h
(much)e(lik)o(e)h(libnids)g(is)h(based)f(on)g(Linux)f(2.0.37.)p
Black Black -239 1827 a Fc(\017)p Black 0 TeXcolorgray
41 w Fi(Scre)n(w)25 b(it)i(and)e(say)g(that)h(IP)g(fragmentation)d(and)
i(out)g(of)h(order)e(IP)i(pack)o(ets/TCP)g(se)o(gments)e(are)i(not)f
(supported.)39 b(Not)26 b(sure)f(if)h(this)g(will)h(meet)e(the)-156
1927 y(needs)20 b(of)f(potential)h(users.)p Black -364
2199 a Ff(4.2)p 0 TeXcolorgray 99 w(Blocking)p Black
0 TeXcolorgray -364 2394 a Fi(As)i(earlier)f(stated,)h(one)e(of)h(the)g
(main)g(goals)g(of)g(this)h(project)e(is)j(to)e(k)o(eep)g(things)f
(single)i(threaded)d(to)j(mak)o(e)e(coding)g(plugins)g(easier)-5
b(.)29 b(One)21 b(ca)n(v)o(eat)g(of)g(that)g(is)-364
2493 y(that)g(an)o(y)e(function)f(which)i(blocks)g(will)g(cause)h
(serious)f(problems.)p Black 0 TeXcolorgray -364 2632
a(There)g(are)g(three)f(major)h(cases)h(where)e(blocking)g(is)i(lik)o
(ely)f(to)g(occur:)p Black Black -260 2827 a(1.)p Black
0 TeXcolorgray 41 w(Opening)e(a)j(sock)o(et)p Black Black
-260 2982 a(2.)p Black 0 TeXcolorgray 41 w(Reading)e(from)g(a)i(sock)o
(et)p Black Black -260 3138 a(3.)p Black 0 TeXcolorgray
41 w(Writing)f(to)g(a)h(sock)o(et)p Black 0 TeXcolorgray
-364 3333 a(Reading)h(from)g(sock)o(ets)h(in)f(a)h(non-blocking)c
(manner)j(is)h(easy)g(to)g(solv)o(e)f(for)g(using)g(poll\(\))g(or)g
(select\(\).)32 b(Writing)23 b(to)g(a)g(sock)o(et,)g(or)f(merely)g
(opening)e(a)k(TCP)-364 3432 y(sock)o(et)c(via)g(connect\(\))f(ho)n(we)
n(v)o(er)f(requires)h(a)i(dif)n(ferent)d(method:)p Black
Black Black 0 TeXcolorgray -32 3627 a(It)i(is)g(possible)f(to)g(do)f
(non-blocking)e(IO)j(on)g(sock)o(ets)g(by)g(setting)g(the)g(O_NONBLOCK)
g(\003ag)g(on)g(a)h(sock)o(et)f(\002le)g(descriptor)f(using)g
(fcntl\(2\).)-156 3727 y(Then)26 b(all)i(operations)d(that)i(w)o(ould)f
(block)g(will)i(\(usually\))e(return)g(with)h(EA)m(GAIN)f(\(operation)f
(should)h(be)h(retried)f(later\);)k(connect\(2\))25 b(will)-156
3826 y(return)19 b(EINPR)m(OGRESS)h(error)-5 b(.)25 b(The)19
b(user)i(can)f(then)f(w)o(ait)i(for)f(v)n(arious)f(e)n(v)o(ents)g(via)i
(poll\(2\))d(or)i(select\(2\).)p Black -30 x Fg(7)p 0
TeXcolorgray -364 4021 a Fi(If)g(connect\(\))f(returns)g(EINPR)m
(OGRESS,)h(then)g(we')o(ll)g(just)h(ha)n(v)o(e)f(to)g(do)g(something)f
(lik)o(e)h(this:)p Black Black Black 0 TeXcolorgray -156
4216 a Fb(int)43 b(e,)g(len=sizeof\(e\);)p Black 0 TeXcolorgray
-156 4316 a(if)g(\(getsockopt\(conn->s,)49 b(SOL_SOCKET,)d(SO_ERROR,)f
(&e,)f(&len\))g(<)f(0\))g({)p Black 0 TeXcolorgray 13
4416 a(/*)g(not)h(yet)f(*/)p Black 0 TeXcolorgray 13
4515 a(if\(errno)i(!=)e(EINPROGRESS\){)89 b(/*)43 b(yuck.)h(kill)g(it.)
f(*/)p Black 0 TeXcolorgray 140 4615 a(log_fn\(LOG_DEBUG,"i)q(n-p)q
(rog)q(res)q(s)48 b(connect)d(failed.)g(Removing."\);)p
Black 0 TeXcolorgray 140 4714 a(return)g(-1;)p Black
0 TeXcolorgray 13 4814 a(})e(else)h({)p Black 0 TeXcolorgray
140 4914 a(return)h(0;)e(/*)g(no)g(change,)h(see)g(if)f(next)g(time)h
(is)f(better)i(*/)p Black 0 TeXcolorgray 13 5013 a(})p
Black 0 TeXcolorgray -156 5113 a(})p Black 0 TeXcolorgray
-156 5213 a(/*)e(the)g(connect)i(has)e(finished.)j(*/)p
Black Black Black 0 TeXcolorgray -156 5408 a Fi(Note:)25
b(It)20 b(may)f(not)h(be)f(totally)h(right,)f(b)n(ut)h(it)g(w)o(orks)f
(ok.)25 b(\(that)19 b(chunk)g(of)g(code)g(gets)h(called)g(after)f(poll)
h(returns)f(the)g(sock)o(et)h(as)h(writable.)j(if)c(poll)-156
5507 y(returns)f(it)i(as)g(readable,)e(then)g(it')-5
b(s)22 b(probably)c(because)h(of)h(eof,)f(connect)g(f)o(ails.)26
b(Y)-9 b(ou)20 b(must)g(poll)g(for)f(both.)p Black Black
-364 5568 1851 4 v -273 5622 a Fe(7)p 0 TeXcolorgray
-244 5646 a Fd(sock)o(et\(7\))p Black Black Black 1929
5895 a Fi(4)p Black eop end
%%Page: 5 5
TeXDict begin 5 4 bop Black Black -364 -281 a Fh(5)p
0 TeXcolorgray 120 w(pcap)30 b(vs)f(\003o)o(w)i(File)f(F)m(ormat)p
Black 0 TeXcolorgray -364 -52 a Fi(As)19 b(stated)g(before,)e(the)h
(pcap)f(\002le)i(format)e(really)h(isn')o(t)g(well)h(suited)f(for)g
(\003o)n(wreplay)f(because)g(it)i(uses)g(the)f(ra)o(w)g(pack)o(et)g(as)
h(a)f(container)f(for)h(data.)24 b(Flo)n(wreplay)-364
47 y(ho)n(we)n(v)o(er)19 b(isn')o(t)i(interested)g(in)g(pack)o(ets,)g
(it')-5 b(s)22 b(interested)e(in)i(data)f(streams)p Black
-30 x Fg(8)p 0 TeXcolorgray 1852 47 a Fi(which)f(may)h(span)g(one)g(or)
f(more)h(TCP/UDP)h(se)o(gments,)e(each)h(comprised)f(of)g(an)-364
147 y(IP)h(datagram)e(which)g(may)h(be)h(comprised)d(of)i(multiple)g
(IP)h(fragments.)j(Handling)18 b(all)j(this)g(additional)e(comple)o
(xity)f(requires)i(a)g(full)h(TCP/IP)g(stack)f(in)g(user)-364
247 y(space)g(which)g(w)o(ould)g(ha)n(v)o(e)f(additional)g(feature)g
(requirements)f(speci\002c)j(to)f(\003o)n(wreplay)-5
b(.)p Black 0 TeXcolorgray -364 389 a(Rather)18 b(then)f(trying)g(to)h
(do)g(that,)g(I')l(v)o(e)f(decided)g(to)h(create)f(a)i(pcap)e
(preprocessor)f(for)h(\003o)n(wreplay)f(called:)24 b(\003o)n(wprep.)f
(Flo)n(wprep)17 b(will)h(handle)f(all)i(the)f(TCP/IP)-364
489 y(defragmentation/reassembly)e(and)j(write)i(out)f(a)g(\002le)h
(containing)d(the)i(data)h(streams)f(for)g(each)f(\003o)n(w)-5
b(.)p Black 0 TeXcolorgray -364 632 a(A)21 b(\003o)n(w)f(\002le)h(will)
g(contain)e(three)h(sections:)p Black Black -260 840
a(1.)p Black 0 TeXcolorgray 41 w(A)g(header)f(which)h(identi\002es)g
(this)h(as)g(a)g(\003o)n(wprep)d(\002le)j(and)f(the)g(\002le)h(v)o
(ersion)p Black Black -260 1000 a(2.)p Black 0 TeXcolorgray
41 w(An)f(inde)o(x)f(of)h(all)h(the)f(\003o)n(ws)g(contained)f(in)h
(the)h(\002le)p Black Black -260 1159 a(3.)p Black 0
TeXcolorgray 41 w(The)f(data)g(streams)g(themselv)o(es)p
Black Black Black 0 TeXcolorgray 163 5194 a @beginspecial
0 @llx 0 @lly 429 @urx 470 @ury 4290 @rwi @setspecial
%%BeginDocument: flowheader.eps
%!PS-Adobe-2.0 EPSF-2.0
%%Title: flowheader.fig
%%Creator: fig2dev Version 3.2 Patchlevel 3d
%%CreationDate: Sun Jul  3 13:03:01 2005
%%For: aturner@Syrah.local (Aaron Turner)
%%BoundingBox: 0 0 429 470
%%Magnification: 1.0000
%%EndComments
/$F2psDict 200 dict def
$F2psDict begin
$F2psDict /mtrx matrix put
/col-1 {0 setgray} bind def
/col0 {0.000 0.000 0.000 srgb} bind def
/col1 {0.000 0.000 1.000 srgb} bind def
/col2 {0.000 1.000 0.000 srgb} bind def
/col3 {0.000 1.000 1.000 srgb} bind def
/col4 {1.000 0.000 0.000 srgb} bind def
/col5 {1.000 0.000 1.000 srgb} bind def
/col6 {1.000 1.000 0.000 srgb} bind def
/col7 {1.000 1.000 1.000 srgb} bind def
/col8 {0.000 0.000 0.560 srgb} bind def
/col9 {0.000 0.000 0.690 srgb} bind def
/col10 {0.000 0.000 0.820 srgb} bind def
/col11 {0.530 0.810 1.000 srgb} bind def
/col12 {0.000 0.560 0.000 srgb} bind def
/col13 {0.000 0.690 0.000 srgb} bind def
/col14 {0.000 0.820 0.000 srgb} bind def
/col15 {0.000 0.560 0.560 srgb} bind def
/col16 {0.000 0.690 0.690 srgb} bind def
/col17 {0.000 0.820 0.820 srgb} bind def
/col18 {0.560 0.000 0.000 srgb} bind def
/col19 {0.690 0.000 0.000 srgb} bind def
/col20 {0.820 0.000 0.000 srgb} bind def
/col21 {0.560 0.000 0.560 srgb} bind def
/col22 {0.690 0.000 0.690 srgb} bind def
/col23 {0.820 0.000 0.820 srgb} bind def
/col24 {0.500 0.190 0.000 srgb} bind def
/col25 {0.630 0.250 0.000 srgb} bind def
/col26 {0.750 0.380 0.000 srgb} bind def
/col27 {1.000 0.500 0.500 srgb} bind def
/col28 {1.000 0.630 0.630 srgb} bind def
/col29 {1.000 0.750 0.750 srgb} bind def
/col30 {1.000 0.880 0.880 srgb} bind def
/col31 {1.000 0.840 0.000 srgb} bind def

end
save
newpath 0 470 moveto 0 0 lineto 429 0 lineto 429 470 lineto closepath clip newpath
-215.3 477.7 translate
1 -1 scale

/cp {closepath} bind def
/ef {eofill} bind def
/gr {grestore} bind def
/gs {gsave} bind def
/sa {save} bind def
/rs {restore} bind def
/l {lineto} bind def
/m {moveto} bind def
/rm {rmoveto} bind def
/n {newpath} bind def
/s {stroke} bind def
/sh {show} bind def
/slc {setlinecap} bind def
/slj {setlinejoin} bind def
/slw {setlinewidth} bind def
/srgb {setrgbcolor} bind def
/rot {rotate} bind def
/sc {scale} bind def
/sd {setdash} bind def
/ff {findfont} bind def
/sf {setfont} bind def
/scf {scalefont} bind def
/sw {stringwidth} bind def
/tr {translate} bind def
/tnt {dup dup currentrgbcolor
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add srgb}
  bind def
/shd {dup dup currentrgbcolor 4 -2 roll mul 4 -2 roll mul
  4 -2 roll mul srgb} bind def
/$F2psBegin {$F2psDict begin /$F2psEnteredState save def} def
/$F2psEnd {$F2psEnteredState restore end} def

$F2psBegin
10 setmiterlimit
 0.06000 0.06000 sc
%
% Fig objects follow
%
/Times-Roman ff 180.00 scf sf
4575 1875 m
gs 1 -1 sc (Version) col0 sh gr
% Polyline
7.500 slw
n 6000 3450 m
 6000 3750 l gs col0 s gr 
% Polyline
n 3600 2850 m
 8400 2850 l gs col0 s gr 
% Polyline
n 3600 3150 m
 8400 3150 l gs col0 s gr 
% Polyline
n 3600 3450 m
 8400 3450 l gs col0 s gr 
% Polyline
n 3600 3750 m
 8400 3750 l gs col0 s gr 
% Polyline
n 3600 2550 m 8400 2550 l 8400 4350 l 3600 4350 l
 cp gs col0 s gr 
% Polyline
n 7200 3150 m
 7200 3450 l gs col0 s gr 
% Polyline
 [15 45] 45 sd
n 3600 4050 m
 8400 4050 l gs col0 s gr  [] 0 sd
% Polyline
n 3600 4950 m 8400 4950 l 8400 5250 l 3600 5250 l
 cp gs col0 s gr 
% Polyline
n 4800 5250 m
 4800 5550 l gs col0 s gr 
% Polyline
n 3600 5550 m
 8400 5550 l gs col0 s gr 
% Polyline
n 3600 5250 m 8400 5250 l 8400 6150 l 3600 6150 l
 cp gs col0 s gr 
% Polyline
n 3600 1350 m 8400 1350 l 8400 1950 l 3600 1950 l
 cp gs col0 s gr 
% Polyline
n 3600 1650 m
 8400 1650 l gs col0 s gr 
% Polyline
 [15 45] 45 sd
n 3600 6750 m 8400 6750 l 8400 7950 l 3600 7950 l
 cp gs col0 s gr  [] 0 sd
% Polyline
n 3600 6150 m 8400 6150 l 8400 6750 l 3600 6750 l
 cp gs col0 s gr 
% Polyline
 [15 45] 45 sd
n 3600 6450 m
 8400 6450 l gs col0 s gr  [] 0 sd
% Polyline
 [15 45] 45 sd
n 3600 5850 m
 8400 5850 l gs col0 s gr  [] 0 sd
% Polyline
n 3600 450 m
 8400 450 l gs col0 s gr 
% Polyline
n 3600 150 m 8400 150 l 8400 750 l 3600 750 l
 cp gs col0 s gr 
% Polyline
n 4800 150 m
 4800 450 l gs col0 s gr 
% Polyline
n 6000 150 m
 6000 450 l gs col0 s gr 
% Polyline
n 7200 150 m
 7200 450 l gs col0 s gr 
% Polyline
n 6000 5250 m
 6000 5550 l gs col0 s gr 
% Polyline
n 6000 1650 m
 6000 1950 l gs col0 s gr 
/Times-Roman ff 180.00 scf sf
4350 3375 m
gs 1 -1 sc (IP Protocol) col0 sh gr
/Times-Roman ff 180.00 scf sf
5250 2775 m
gs 1 -1 sc (Client \(Source\) IP) col0 sh gr
/Times-Roman ff 180.00 scf sf
5100 3075 m
gs 1 -1 sc (Server \(Destination\) IP) col0 sh gr
/Times-Roman ff 180.00 scf sf
3900 3675 m
gs 1 -1 sc (Client Port/ICMP Type) col0 sh gr
/Times-Roman ff 180.00 scf sf
6375 3675 m
gs 1 -1 sc (Server Port/ICMP Code) col0 sh gr
/Times-Roman ff 180.00 scf sf
6375 3375 m
gs 1 -1 sc (Flags) col0 sh gr
/Times-Roman ff 180.00 scf sf
7350 3375 m
gs 1 -1 sc (Instance) col0 sh gr
/Times-Roman ff 180.00 scf sf
8625 5100 m
gs 1 -1 sc (Flag 1: Direction) col0 sh gr
/Times-Roman ff 180.00 scf sf
8625 2775 m
gs 1 -1 sc (Flag 1: Last Index) col0 sh gr
/Times-Roman ff 180.00 scf sf
8625 3000 m
gs 1 -1 sc (Flag 2: Ignore) col0 sh gr
/Times-Roman ff 180.00 scf sf
8625 3225 m
gs 1 -1 sc (Flag 3: Server Socket) col0 sh gr
/Times-Roman ff 180.00 scf sf
8625 5325 m
gs 1 -1 sc (Flag 2: Ignore) col0 sh gr
/Times-Roman ff 180.00 scf sf
4950 5175 m
gs 1 -1 sc (Data Length of This Stream) col0 sh gr
/Times-Roman ff 180.00 scf sf
3675 5475 m
gs 1 -1 sc (Flags) col0 sh gr
/Times-Roman ff 180.00 scf sf
4875 3975 m
gs 1 -1 sc (Offset to First Data Stream) col0 sh gr
/Times-Roman ff 180.00 scf sf
8625 5775 m
gs 1 -1 sc (Flag 4: Urgent Data Exists) col0 sh gr
/Times-Roman ff 180.00 scf sf
5400 1575 m
gs 1 -1 sc (Magic Number) col0 sh gr
/Times-Roman ff 180.00 scf sf
5475 7350 m
gs 1 -1 sc (Data Stream) col0 sh gr
/Times-Roman ff 180.00 scf sf
4950 6375 m
gs 1 -1 sc (Offset to Next Data Segment) col0 sh gr
/Times-Roman ff 180.00 scf sf
5475 675 m
gs 1 -1 sc (32 Bit Word) col0 sh gr
/Times-Roman ff 180.00 scf sf
3975 375 m
gs 1 -1 sc (8 Bits) col0 sh gr
/Times-Roman ff 180.00 scf sf
5100 5475 m
gs 1 -1 sc (Urg Data) col0 sh gr
/Times-Roman ff 180.00 scf sf
6825 5475 m
gs 1 -1 sc (Reserved) col0 sh gr
/Times-Roman ff 180.00 scf sf
5625 5775 m
gs 1 -1 sc (Timestamp) col0 sh gr
/Times-Roman ff 180.00 scf sf
5475 6675 m
gs 1 -1 sc (In This Flow) col0 sh gr
/Times-Roman ff 180.00 scf sf
5325 2475 m
gs 1 -1 sc (Flow Index Entry) col0 sh gr
/Times-Roman ff 180.00 scf sf
5250 4875 m
gs 1 -1 sc (Data Stream Header) col0 sh gr
/Times-Roman ff 180.00 scf sf
5250 1275 m
gs 1 -1 sc (Flowprep File Header) col0 sh gr
/Times-Roman ff 180.00 scf sf
8625 5550 m
gs 1 -1 sc (Flag 3: More Data Streams) col0 sh gr
/Times-Roman ff 180.00 scf sf
6900 1875 m
gs 1 -1 sc (Reserved) col0 sh gr
% Polyline
n 6000 3150 m
 6000 3450 l gs col0 s gr 
$F2psEnd
rs

%%EndDocument
 @endspecial Black 0 TeXcolorgray -364 5402 a(At)h(startup,)e(the)h
(\002le)g(header)f(is)h(v)n(alidated)f(and)g(the)h(data)g(stream)g
(inde)o(x)o(es)e(are)i(loaded)e(into)i(memory)-5 b(.)23
b(Then)c(the)g(\002rst)i(data)f(stream)f(header)g(from)g(each)g(\003o)n
(w)-364 5502 y(is)i(read.)k(Then)19 b(each)h(\003o)n(w)g(and)g
(subsequent)f(data)h(stream)g(is)h(processed)e(based)h(upon)f(the)h
(timestamps)g(and)f(plug-ins.)p Black Black -364 5566
1851 4 v -273 5622 a Fe(8)p 0 TeXcolorgray -244 5646
a Fd(A)d(\223data)j(stream\224)f(as)f(I)g(call)h(it)g(is)f(a)g(simple)o
(x)h(communication)i(from)c(the)i(client)h(or)e(serv)o(er)h(which)g(is)
f(a)g(complete)i(query)l(,)e(response)h(or)f(message.)p
Black Black Black 1929 5895 a Fi(5)p Black eop end
%%Page: 6 6
TeXDict begin 6 5 bop Black Black -364 -281 a Fh(6)p
0 TeXcolorgray 120 w(Plug-ins)p Black 0 TeXcolorgray
-364 -54 a Fi(Plug-ins)24 b(will)h(pro)o(vide)e(the)h
(\223intelligence\224)f(in)i(\003o)n(wreplay)-5 b(.)36
b(Flo)n(wreplay)23 b(is)i(designed)e(to)i(be)f(a)h(mere)f(frame)n(w)o
(ork)e(for)i(connecting)f(captured)f(\003o)n(ws)j(in)g(a)-364
45 y(\003o)n(w)c(\002le)f(with)h(sock)o(et)f(\002le)h(handles.)j(Ho)n
(w)c(data)g(is)h(processed)e(and)h(what)g(should)f(be)h(done)f(with)i
(it)g(will)g(be)f(done)f(via)h(plug-ins.)p Black 0 TeXcolorgray
-364 185 a(Plug-ins)i(will)g(allo)n(w)g(proper)f(handling)f(of)i(a)g(v)
n(ariety)f(of)h(protocols)f(while)h(hopefully)e(k)o(eeping)g(things)i
(simple.)30 b(Another)21 b(part)h(of)g(the)g(consideration)e(will)-364
285 y(be)g(making)f(it)i(easy)f(for)g(others)g(to)g(contrib)n(ute)f(to)
h(\003o)n(wreplay)-5 b(.)23 b(I)e(don')o(t)d(w)o(ant)i(to)h(ha)n(v)o(e)
e(to)i(write)f(all)h(the)f(protocol)e(logic)i(myself.)p
Black -364 559 a Ff(6.1)p 0 TeXcolorgray 99 w(Plug-in)25
b(Basics)p Black 0 TeXcolorgray -364 756 a Fi(Each)20
b(plug-in)f(pro)o(vides)g(the)h(logic)g(for)g(handling)e(one)i(or)g
(more)g(services.)25 b(The)20 b(main)g(purpose)f(of)h(a)h(plug-in)e(is)
i(to)g(decide)e(when)h(\003o)n(wreplay)f(should)h(send)-364
855 y(data)h(via)h(one)e(or)h(more)g(sock)o(ets.)28 b(The)21
b(plug-in)f(can)h(use)g(an)o(y)p Black 0 TeXcolorgray
21 w Fa(non-bloc)n(king)p Black 0 TeXcolorgray 18 w Fi(method)f(of)h
(determining)e(if)j(it)g(appropriate)d(to)i(send)g(data)g(or)g(w)o(ait)
h(for)f(data)g(to)-364 955 y(recei)n(v)o(ed.)j(If)c(necessary)-5
b(,)18 b(a)j(plug-in)e(can)h(also)g(modify)f(the)h(data)g(sent.)p
Black 0 TeXcolorgray -364 1095 a(Each)j(time)h(poll\(\))e(returns,)i
(\003o)n(wreplay)e(calls)i(the)g(plug-ins)e(for)h(the)g(\003o)n(ws)h
(which)f(either)g(ha)n(v)o(e)g(data)g(w)o(aiting)h(or)f(in)h(the)f
(case)h(of)f(a)h(timeout,)g(those)f(\003o)n(ws)-364 1195
y(which)i(timed)g(out.)39 b(Afterw)o(ords,)25 b(all)h(the)g(\003o)n(ws)
f(are)g(processed)f(and)h(poll\(\))f(is)i(called)f(on)g(those)g(\003o)n
(ws)h(which)f(ha)n(v)o(e)f(their)h(state)h(set)g(to)g(POLL.)f(And)f
(the)-364 1295 y(process)c(repeats)g(until)g(there)g(are)g(no)f(more)h
(nodes)f(in)i(the)f(tree.)p Black -364 1569 a Ff(6.2)p
0 TeXcolorgray 99 w(The)26 b(Default)g(Plug-in)p Black
0 TeXcolorgray -364 1765 a Fi(Initially)-5 b(,)30 b(\003o)n(wreplay)d
(will)i(ship)f(with)h(one)f(basic)g(plug-in)f(called)i(\223def)o
(ault\224.)48 b(An)o(y)28 b(\003o)n(w)h(which)e(doesn')o(t)g(ha)n(v)o
(e)h(a)h(speci\002c)g(plug-in)e(de\002ned,)i(will)g(use)-364
1865 y(def)o(ault.)f(The)21 b(goal)g(of)g(the)g(def)o(ault)g(plug-in)e
(is)k(to)e(w)o(ork)g(\223good)e(enough\224)h(for)g(a)i(majority)e(of)h
(single-\003o)n(w)g(protocols)f(such)h(as)h(SMTP)-9 b(,)21
b(HTTP)-9 b(,)21 b(and)g(T)-6 b(elnet.)-364 1965 y(Protocols)23
b(which)g(use)h(encryption)d(\(SSL,)i(SSH,)h(etc\))g(or)f(multiple)g
(\003o)n(ws)h(\(FTP)-9 b(,)23 b(RPC,)i(etc\))e(will)i(ne)n(v)o(er)d(w)o
(ork)h(with)g(the)h(def)o(ault)f(plug-in.)33 b(Furthermore,)-364
2064 y(the)20 b(def)o(ault)g(plug-in)f(will)h(only)g(support)f
(connections)p Black 0 TeXcolorgray 18 w Fa(to)p Black
0 TeXcolorgray 20 w Fi(a)i(serv)o(er)m(,)e(it)i(will)g(not)e(support)g
(accepting)g(connections)f(from)i(clients.)p Black 0
TeXcolorgray -364 2204 a(The)f(def)o(ault)f(plug-in)f(will)j(pro)o
(vide)d(no)h(data)h(le)n(v)o(el)f(manipulation)f(and)h(only)g(a)i
(simple)e(method)g(for)g(detecting)g(when)g(it)i(is)g(time)f(to)g(send)
f(data)h(to)g(the)g(serv)o(er)-5 b(.)-364 2304 y(Detecting)22
b(when)f(to)h(send)g(data)g(will)g(be)g(done)f(by)h(a)g(\223no)g(more)f
(data\224)h(timeout)f(v)n(alue.)29 b(Basically)-5 b(,)23
b(by)e(using)h(the)g(pcap)f(\002le)i(as)g(a)f(means)g(to)g(determine)e
(the)-364 2404 y(order)i(of)h(the)g(e)o(xchange,)e(an)o(ytime)g(it)j
(is)g(the)f(serv)o(ers)f(turn)h(to)g(send)f(data,)i(\003o)n(wreplay)d
(will)j(w)o(ait)g(for)e(the)h(\002rst)h(byte)e(of)h(data)f(and)h(then)f
(start)i(the)f(\223no)f(more)-364 2503 y(data\224)c(timer)-5
b(.)25 b(Ev)o(ery)16 b(time)j(more)e(data)h(is)h(recei)n(v)o(ed,)e(the)
h(timer)g(is)h(reset.)24 b(If)18 b(the)g(timer)g(reaches)g(zero,)g
(then)f(\003o)n(wreplay)g(sends)h(the)g(ne)o(xt)g(portion)e(of)i(the)g
(client)-364 2603 y(side)24 b(of)e(the)h(connection.)32
b(This)23 b(is)h(repeated)e(until)h(the)g(the)g(\003o)n(w)g(has)h(been)
e(completely)f(replayed)h(or)h(a)g(\223serv)o(er)f(hung\224)g(timeout)g
(is)i(reached.)32 b(The)23 b(serv)o(er)-364 2703 y(hung)c(timeout)g(is)
j(used)e(to)g(detect)g(a)h(serv)o(er)e(which)h(crashed)f(and)g(ne)n(v)o
(er)g(starts)i(sending)e(an)o(y)h(data)g(which)f(w)o(ould)h(start)h
(the)f(\223no)f(more)h(data\224)g(timer)-5 b(.)p Black
0 TeXcolorgray -364 2843 a(Both)20 b(the)h(\223no)e(more)h(data\224)g
(and)f(\223serv)o(er)g(hung\224)g(timers)h(will)h(be)f(user)h
(de\002ned)e(v)n(alues)g(and)h(global)f(to)i(all)g(\003o)n(ws)f(using)g
(the)g(def)o(ault)f(plug-in.)p Black -364 3117 a Ff(6.3)p
0 TeXcolorgray 99 w(Plug-in)25 b(Details)p Black 0 TeXcolorgray
-364 3314 a Fi(Each)20 b(plug-in)f(will)h(be)h(comprised)d(of)i(the)g
(follo)n(wing:)p Black Black -260 3514 a(1.)p Black 0
TeXcolorgray 41 w(An)g(optional)f(global)g(data)h(structure,)f(for)h
(intra-\003o)n(w)f(communication)p Black Black -260 3671
a(2.)p Black 0 TeXcolorgray 41 w(Per)n(-\003o)n(w)h(data)g(structure,)f
(for)g(tracking)g(\003o)n(w)h(state)h(information)p Black
Black -260 3828 a(3.)p Black 0 TeXcolorgray 41 w(A)f(list)i(of)e
(functions)e(which)i(\003o)n(w)g(replay)g(will)h(call)f(when)g(certain)
f(well-de\002ned)g(conditions)g(are)h(met.)p Black Black
-57 3997 a Fc(\017)p Black 0 TeXcolorgray 41 w Fi(Required)g
(functions:)p Black Black 99 4125 a Fc(\003)p Black 0
TeXcolorgray 41 w Fi(initialize_node\(\))d(-)k(called)f(when)f(a)i
(node)e(in)h(the)h(tree)f(created)f(using)h(this)h(plug-in)p
Black Black 99 4236 a Fc(\003)p Black 0 TeXcolorgray
41 w Fi(post_poll_timeout\(\))16 b(-)k(called)g(when)g(the)g(poll\(\))f
(returned)g(due)g(to)i(a)f(timeout)g(for)f(this)i(node)p
Black Black 99 4348 a Fc(\003)p Black 0 TeXcolorgray
41 w Fi(post_poll_read\(\))16 b(-)21 b(called)f(when)f(the)h(poll\(\))g
(returned)e(due)i(to)g(the)g(sock)o(et)g(being)f(ready)p
Black Black 99 4460 a Fc(\003)p Black 0 TeXcolorgray
41 w Fi(b)n(uf)n(fer_full\(\))e(-)j(called)g(when)g(a)g(the)g(pack)o
(et)g(b)n(uf)n(fer)f(for)g(this)i(\003o)n(w)f(is)i(full)p
Black Black 99 4571 a Fc(\003)p Black 0 TeXcolorgray
41 w Fi(delete_node\(\))17 b(-)j(called)g(just)h(prior)e(to)i(the)f
(node)f(being)g(free\(\)')l(d)p Black Black -57 4699
a Fc(\017)p Black 0 TeXcolorgray 41 w Fi(Optional)h(functions:)p
Black Black 99 4826 a Fc(\003)p Black 0 TeXcolorgray
41 w Fi(pre_send_data\(\))c(-)21 b(called)f(before)e(data)j(is)g(sent)p
Black Black 99 4938 a Fc(\003)p Black 0 TeXcolorgray
41 w Fi(post_send_data\(\))c(-)j(called)g(after)g(data)g(is)h(sent)p
Black Black 99 5050 a Fc(\003)p Black 0 TeXcolorgray
41 w Fi(pre_poll\(\))c(-)k(called)f(prior)f(to)h(poll\(\))p
Black Black 99 5161 a Fc(\003)p Black 0 TeXcolorgray
41 w Fi(post_poll_def)o(ault\(\))c(-)k(called)g(when)g(poll\(\))f
(returns)h(and)f(neither)h(the)g(sock)o(et)g(w)o(as)h(ready)e(or)h(the)
g(node)f(timed)h(out)p Black Black 99 5273 a Fc(\003)p
Black 0 TeXcolorgray 41 w Fi(open_sock)o(et\(\))d(-)j(called)g(after)g
(the)g(sock)o(et)g(is)i(opened)p Black Black 99 5385
a Fc(\003)p Black 0 TeXcolorgray 41 w Fi(close_sock)o(et\(\))c(-)j
(called)f(after)f(the)i(sock)o(et)f(is)h(closed)p Black
Black Black Black 1929 5895 a(6)p Black eop end
%%Trailer

userdict /end-hook known{end-hook}if
%%EOF
